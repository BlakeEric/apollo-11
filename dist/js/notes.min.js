/*! apollo-11 v0.0.1 | (c) 2020 Blake Lundquist | MIT License | https://github.com/BlakeEric/apollo-11 */
"use strict";var notes=(function(){function i(){state.toggleStudyGuideDownloadButton(),t.innerHTML=state.notes.length,0===state.notes.length?document.getElementById("notes-summary-toggle").setAttribute("disabled","disabled"):document.getElementById("notes-summary-toggle").removeAttribute("disabled");var n=document.getElementById("notesSummary-window-currentNotes");n.innerHTML="",state.notes.forEach((function(t){var e=document.createElement("div");e.classList.add("note-fields"),e.innerHTML="<label>".concat(t.selectionText,"</label>"),t.content?e.innerHTML+='<p data-noteId="'.concat(t.id,'">').concat(t.content,"</p>"):e.innerHTML+='<br/><a href="#" class="edit-note" data-noteId="'.concat(t.id,'">Add a note about this</a>'),n.appendChild(e),document.getElementById(t.id)||(function(t){var e=document.createElement("span");e.id=t.id,e.classList.add("highlighted"),e.innerHTML=t.selectionText,t.range.surroundContents(e);var n=document.createElement("div");n.classList.add("inline-note"),n.id=t.id+"-comment",n.innerHTML='<fieldset>\n        <textarea data-noteId="'.concat(t.id,'" class="note-field" placeholder="Add your comment here...">').concat(t.content,'</textarea>\n        <button data-noteId="').concat(t.id,'" class="button-standard delete-note">Delete</button>\n      </fieldset>'),e.after(n)})(t)}))}var e=document.getElementById("notesSummary-window"),t=document.getElementById("note-count");function r(t){document.getElementById("notesSummary-window").classList.remove("active"),document.querySelector("#".concat(t,"-comment textarea")).focus()}function n(){u();var t,e,n,o,a=g(),d=a.toString(),c=a.getRangeAt(0);t=a,e=d,n=c,o={id:"note-"+s(),selection:t||null,selectionText:e.trim().replace(/(\r\n|\n|\r)/gm," ").replace(/\s+/g," "),range:n,content:""},state.set("notes",state.notes.concat(o)),i(),r(o.id),l()}var s=function(){return Math.random().toString(36).substr(2,9)},l=function(){rangy.getSelection().collapseToEnd()},u=function(){var t=document.querySelector(".selected-add-note-dialogue");t&&t.parentNode.removeChild(t)},g=function(){var t=rangy.getSelection();t.refresh();var e=t.toString();return!t.getRangeAt(0).canSurroundContents()||e.length<1?null:t};return{init:function(){events.on("click",".copy-selected-to-note",(function(t){t.preventDefault(),n()})),events.on("click",".clear-notes-dialogue",(function(t){t.preventDefault(),u()})),events.on("click",".notes-summary-toggle",(function(t){t.preventDefault(),e.classList.toggle("active")})),events.on("click",".note-fields > p, a.edit-note",(function(t){t.preventDefault();var e=t.target.getAttribute("data-noteId");r(e)})),events.on("click","span.highlighted",(function(t){t.preventDefault();var e=t.target.getAttribute("id");r(e)})),events.on("click",".delete-note",(function(t){t.preventDefault(),(function(e){state.set("notes",state.notes.filter((function(t){return e!=t.id})));var t=document.getElementById(e);t.outerHTML=t.innerHTML;var n=document.getElementById(e+"-comment");n.parentNode.removeChild(n),i()})(t.target.getAttribute("data-noteId"))})),events.on("input",".note-field",(function(t){var e,n;t.preventDefault(),e=t,n=state.notes.map((function(t){return t.id==e.target.getAttribute("data-noteId")&&(t.content=e.target.value),t})),state.set("notes",n),i();var o=t.target,a=o.offsetHeight-o.clientHeight+12;o.style.height="auto",o.style.height=o.scrollHeight+a+"px"})),events.on("mouseup","#content",(function(t){var e,n,o,a,d;u(),g()&&(e=t,n=document.documentElement.scrollTop||document.body.scrollTop,o=e.clientX-50,a=e.clientY+n-70,(d=document.createElement("span")).classList.add("selected-add-note-dialogue"),d.innerHTML='<strong>Add note?</strong><br/>    <button class="button-standard copy-selected-to-note">Add</button>    <button class="button-standard clear-notes-dialogue">Ã—</button>',d.style.position="absolute",d.style.top=a.toString()+"px",d.style.left=o.toString()+"px",document.body.appendChild(d))})),i()}}})();